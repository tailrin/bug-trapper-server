DROP TABLE IF EXISTS issue_notes;
DROP TABLE IF EXISTS issues;
DROP TYPE IF EXISTS working;
DROP TABLE IF EXISTS projects;
DROP TABLE IF EXISTS users;

CREATE TYPE working AS ENUM(
    'Active',
    'Closed'
);

CREATE TABLE users (
    id INTEGER NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_name TEXT NOT NULL,
    credentials TEXT NOT NULL
);

CREATE TABLE projects(
    id INTEGER NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_id INTEGER NOT NULL,
    name TEXT NOT NULL,
    date_created TIMESTAMP NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE issues(
    id INTEGER NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    project_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    date_created TIMESTAMP NOT NULL,
    date_modified TIMESTAMP NOT NULL,
    description TEXT NOT NULL,
    status working NOT NULL,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE issue_notes(
    id INTEGER NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    issue_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    date_created TIMESTAMP NOT NULL,
    FOREIGN KEY (issue_id) REFERENCES issues(id) ON DELETE CASCADE
);

